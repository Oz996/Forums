(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[677],{8345:function(e,t,o){Promise.resolve().then(o.bind(o,7532))},1973:function(e,t,o){"use strict";o.d(t,{Jq:function(){return getPosts},PR:function(){return getUser},xl:function(){return getPost}});var l=o(9222);let getPosts=async()=>{try{let e=await l.Z.get("https://forums-api.onrender.com/posts");return e}catch(e){console.error(e)}},getPost=async e=>{try{let t=await l.Z.get("https://forums-api.onrender.com/".concat(e));return t}catch(e){console.error(e)}},getUser=async e=>{try{let t=await l.Z.get("https://forums-api.onrender.com/".concat(e));return t}catch(e){console.error(e)}}},7532:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return Post}});var l=o(7437),n=o(165),s=o(4874),r=o(4001),a=o(6914),i=o(4042),d=o(3469),c=o(8676),u=o(1507),m=o(1396),x=o.n(m),components_UserCard=e=>{var t,o,n;let{data:s}=e;return(0,l.jsxs)(a.w,{className:"p-5 min-w-[15rem] h-full shadow-none border-b-1 border-gray-300 md:border-none",children:[(0,l.jsx)(i.u,{className:"flex justify-center",children:(0,l.jsx)(d.O,{children:(0,l.jsx)(x(),{href:"/user/".concat(null==s?void 0:null===(t=s.user)||void 0===t?void 0:t._id),children:(0,l.jsx)(c.h,{size:"lg",src:null==s?void 0:null===(o=s.user)||void 0===o?void 0:o.image})})})}),(0,l.jsxs)(u.G,{className:"text-center",children:[(0,l.jsx)("p",{children:null==s?void 0:null===(n=s.user)||void 0===n?void 0:n.userName}),(0,l.jsx)("p",{children:"Rank:"}),(0,l.jsx)("p",{}),(0,l.jsx)("p",{children:"Posts:"}),(0,l.jsx)("p",{children:"Joined:"})]})]})},h=o(1973),v=o(6987),f=o(667),p=o(1865),j=o(3800),g=o(7415),y=o(9222),components_CommentForm=e=>{let{params:t}=e,{register:o,handleSubmit:s,reset:a,formState:{errors:i}}=(0,p.cI)(),d=(0,n.NL)(),c=localStorage.getItem("token"),commentMutation=async e=>{let o=await y.Z.post("https://forums-api.onrender.com/posts/".concat(t._id,"/comments"),e,{headers:{Authorization:"Bearer ".concat(c)}});return o.data},u=(0,r.D)(commentMutation,{onSuccess:()=>{g.Am.success("Comment posted"),d.invalidateQueries(["post"])},onError:e=>{console.error(e)},onSettled:()=>{a()}});return(0,l.jsxs)("section",{className:"p-10 md:rounded-xl border",children:[(0,l.jsx)("h2",{className:"font-bold text-xl",children:"Add Comment"}),(0,l.jsxs)("form",{onSubmit:s(e=>{u.mutate(e)}),children:[(0,l.jsx)(v.Y,{...o("text",{required:"Comment can not be empty"}),type:"text"}),(0,l.jsx)(j.B,{name:"text",errors:i,render:e=>{let{message:t}=e;return(0,l.jsx)("p",{className:"text-red-500 text-sm font-semibold",children:t})}}),(0,l.jsxs)("div",{className:"flex justify-between mt-5 items-center",children:[(0,l.jsx)("p",{children:"Characters left"}),(0,l.jsx)(f.A,{type:"submit",color:"secondary",className:"py-6",children:"Post Comment"})]})]})]})},b=o(8740),N=o(1349),C=o(4318),w=o(4823),A=o(2749),S=o(1718),_=o(9571),P=o(2913),k=o(4033),components_DeleteModal=e=>{let{id:t}=e,{isOpen:o,onOpen:n,onOpenChange:s}=(0,C.q)(),r=(0,k.useRouter)(),a=localStorage.getItem("token"),deleteMutation=async()=>{let e=await y.Z.delete("https://forums-api.onrender.com/posts/".concat(t),{headers:{Authorization:"Bearer ".concat(a)}});200===e.status&&(r.push("/"),g.Am.success("Post deleted"))};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(f.A,{className:"mt-2",color:"danger",variant:"light",onPress:n,children:"Delete"}),(0,l.jsx)(w.R,{backdrop:"opaque",isOpen:o,onOpenChange:s,classNames:{backdrop:"bg-gradient-to-t from-zinc-900 to-zinc-900/10 backdrop-opacity-20"},children:(0,l.jsx)(A.A,{children:e=>(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(S.k,{className:"flex flex-col gap-1",children:"Post Deletion"}),(0,l.jsx)(_.I,{children:(0,l.jsx)("p",{children:"Are you sure you want to delete your post?"})}),(0,l.jsxs)(P.R,{children:[(0,l.jsx)(f.A,{variant:"light",onPress:e,children:"Close"}),(0,l.jsx)(f.A,{color:"danger",variant:"light",onPress:e,onClick:deleteMutation,children:"Delete"})]})]})})})]})},E=o(2265);function Post(e){var t,o,a,i,d,c,u,m,x;let{params:j}=e,[C,w]=(0,E.useState)(!1),A=(0,k.useRouter)(),S=(0,n.NL)(),{userEmail:_}=(0,N.a)(),{data:P,isLoading:I}=(0,s.a)({queryKey:["post"],queryFn:()=>(0,h.xl)(j._id)});console.log(P);let M=null==P?void 0:null===(t=P.data)||void 0===t?void 0:t.createdAt.slice(0,10),D=null==P?void 0:null===(o=P.data)||void 0===o?void 0:o.updatedAt.slice(0,10),{register:z,handleSubmit:Z,formState:{errors:q},getValues:F,setValue:R}=(0,p.cI)({defaultValues:{title:(null==P?void 0:null===(a=P.data)||void 0===a?void 0:a.title)||"",body:(null==P?void 0:null===(i=P.data)||void 0===i?void 0:i.body)||""}}),B=localStorage.getItem("token"),editMutation=async e=>{let t=await y.Z.put("https://forums-api.onrender.com/posts/".concat(j._id),e,{headers:{Authorization:"Bearer ".concat(B)}});console.log(t)},deleteCommentMutation=async e=>{let t=await y.Z.delete("https://forums-api.onrender.com/posts/".concat(j._id,"/comments/",9),{headers:{Authorization:"Bearer ".concat(B)}});console.log(t)},O=(0,r.D)(editMutation,{onSuccess:()=>{g.Am.success("Post updated")},onError:e=>{console.error(e)},onSettled:()=>{w(!1),S.invalidateQueries("post")}});return F("title"),F("body"),(0,E.useEffect)(()=>{if(void 0===P)return A.push("/")},[P,A]),(0,l.jsxs)("section",{className:"md:max-w-[62rem] mx-auto container pt-24 flex flex-col gap-10 md:gap-3",children:[(0,l.jsxs)("div",{className:"flex flex-col md:flex-row md:rounded-xl border",children:[(0,l.jsx)("div",{children:(0,l.jsx)(components_UserCard,{data:null==P?void 0:P.data})}),(0,l.jsxs)("div",{className:"flex flex-col p-10 w-full",children:[(0,l.jsx)("div",{className:"flex flex-col md:flex-row justify-between",children:C?(0,l.jsxs)("form",{className:"w-full",onSubmit:Z(e=>{O.mutate(e)}),children:[(0,l.jsx)(b.Y,{...z("title"),label:"Title",variant:"underlined",className:"mb-5",defaultValue:" "}),(0,l.jsx)(v.Y,{...z("body"),label:"Description",variant:"underlined",className:"w-full"}),(0,l.jsx)(f.A,{variant:"ghost",type:"submit",children:"Confirm"})]}):(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-2xl text-center font-semibold mb-10",children:null==P?void 0:null===(d=P.data)||void 0===d?void 0:d.title}),!C&&(0,l.jsxs)("div",{className:"flex  my-6 items-center gap-3",children:[(0,l.jsxs)("p",{className:"text-gray-500 text-sm",children:["Created at ",M]}),(0,l.jsxs)("p",{className:"text-gray-500 text-sm italic",children:["Edited at ",D]})]}),(0,l.jsx)("p",{children:null==P?void 0:null===(c=P.data)||void 0===c?void 0:c.body})]})}),_===(null==P?void 0:null===(m=P.data)||void 0===m?void 0:null===(u=m.user)||void 0===u?void 0:u.email)&&(0,l.jsxs)("div",{className:"flex justify-end border-t mt-5",children:[(0,l.jsx)(f.A,{variant:"light",className:"mt-2",onClick:()=>{var e,t;R("title",(null==P?void 0:null===(e=P.data)||void 0===e?void 0:e.title)||""),R("body",(null==P?void 0:null===(t=P.data)||void 0===t?void 0:t.body)||""),w(e=>!e)},children:C?"Cancel":"Edit"}),(0,l.jsx)(components_DeleteModal,{id:j._id})]})]})]}),null==P?void 0:null===(x=P.data)||void 0===x?void 0:x.comments.map(e=>{var t;return(0,l.jsxs)("div",{className:"flex flex-col md:flex-row md:rounded-xl border w-full ml-auto md:w-[80%]",children:[(0,l.jsx)("div",{children:(0,l.jsx)(components_UserCard,{data:e})}),(0,l.jsxs)("div",{className:"flex flex-col p-10 w-full",children:[(0,l.jsx)("p",{children:null==e?void 0:e.text}),_===(null==e?void 0:null===(t=e.user)||void 0===t?void 0:t.email)&&(0,l.jsxs)("div",{className:"flex justify-end border-t mt-5",children:[(0,l.jsx)(f.A,{variant:"light",className:"mt-2",children:C?"Confirm":"Edit"}),(0,l.jsx)(f.A,{color:"danger",variant:"light",className:"mt-2",onClick:deleteCommentMutation,children:"Delete"})]}),(0,l.jsxs)("p",{className:"text-gray-500 text-sm my-6",children:["Created at ",null==e?void 0:e.createdAt.slice(0,10)]})]})]},e._id)}),(0,l.jsx)(components_CommentForm,{params:j})]})}},4543:function(e,t,o){"use strict";o.d(t,{H:function(){return AuthContextProvider},V:function(){return s}});var l=o(7437),n=o(2265);let s=(0,n.createContext)(null),AuthContextProvider=e=>{let{children:t}=e,[o,r]=(0,n.useState)(!1),[a,i]=(0,n.useState)(null);return(0,n.useEffect)(()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("email");r(!!e),i(t)},[o]),(0,n.useEffect)(()=>{console.log(a)},[a]),(0,l.jsx)(s.Provider,{value:{isAuthenticated:o,userEmail:a,handleLogin:(e,t)=>{console.log("email:",e),r(!0),localStorage.setItem("token",t),localStorage.setItem("email",e),i(e)},handleLogout:()=>{r(!1),localStorage.removeItem("token"),localStorage.removeItem("email"),i(null)}},children:t})}},1349:function(e,t,o){"use strict";o.d(t,{a:function(){return useAuth}});var l=o(4543),n=o(2265);let useAuth=()=>{let e=(0,n.useContext)(l.V);if(!e)throw Error("Failed to use AuthContext");return e}}},function(e){e.O(0,[745,534,396,633,674,505,353,386,520,13,971,864,744],function(){return e(e.s=8345)}),_N_E=e.O()}]);